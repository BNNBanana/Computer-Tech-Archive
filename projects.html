{% extends 'base.html' %}

{% block content %}
<h2><i class="fas fa-layer-group"></i> ทำเนียบโครงงาน (Projects)</h2>
<p>รวบรวมโปรเจคแยกตามปีการศึกษา สามารถดูรายละเอียดและดาวน์โหลดเอกสารได้</p>

{% for year, projects in grouped_projects.items() %}
    <div class="year-header">
        <i class="fas fa-calendar-alt"></i> ปีการศึกษา {{ year }}
    </div>

    <div class="project-grid">
        {% for project in projects %}
        <div class="project-card">
            <h3>{{ project.name }}</h3>
            <p><strong>ผู้จัดทำ:</strong> {{ project.author1 }}, {{ project.author2 }}</p>
            <p><strong>ระดับชั้น:</strong> {{ project.level }}</p>
            <p><strong>รายละเอียด:</strong> {{ project.description }}</p>
            
            <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
            
            <div style="display:flex; flex-direction:column; gap:5px; font-size:0.9em;">
                {% if project.file_report %}
                <a href="{{ url_for('download_file', filename=project.file_report) }}" target="_blank" style="color:#071952;">
                    <i class="fas fa-file-pdf"></i> ดาวน์โหลดเล่มรายงาน
                </a>
                {% endif %}
                
                {% if project.file_manual %}
                <a href="{{ url_for('download_file', filename=project.file_manual) }}" target="_blank" style="color:#071952;">
                    <i class="fas fa-book"></i> ดาวน์โหลดคู่มือ
                </a>
                {% endif %}
                
                {% if project.file_code %}
                    {% if 'http' in project.file_code %}
                        <a href="{{ project.file_code }}" target="_blank" style="color:#071952;"><i class="fab fa-github"></i> Github Repository</a>
                    {% else %}
                        <a href="{{ url_for('download_file', filename=project.file_code) }}" style="color:#071952;"><i class="fas fa-file-archive"></i> ดาวน์โหลด Source Code</a>
                    {% endif %}
                {% endif %}
            </div>

            <div class="project-actions">
                <form action="{{ url_for('delete_project', id=project.id) }}" method="POST" onsubmit="return confirm('ยืนยันที่จะลบโปรเจคนี้?');">
                    <button type="submit" class="btn-sm btn-delete">
                        <i class="fas fa-trash"></i> ลบ
                    </button>
                </form>
                <button onclick="alert('ฟีเจอร์แก้ไขสามารถพัฒนาต่อยอดได้')" class="btn-sm" style="background:#f39c12;">
                    <i class="fas fa-pen"></i> แก้ไข
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <p style="text-align:center; margin-top:50px;">ยังไม่มีข้อมูลโปรเจค</p>
{% endfor %}
{% endblock %}